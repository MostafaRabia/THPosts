function getCountCharacters(){var e=tinyMCE.activeEditor.getContent({format:"raw"}).replace(/<.[^<>]*?>/g,"").replace(/&nbsp;|&#160;| /gi,"");return e.length}function update(){tinyMCE.activeEditor.theme.panel.find("#wordcount").text(["Characters: {0}",getCountCharacters()])}function addComment(){var e=new Date,t=e.getSeconds(),n=$("input[type='hidden']").val(),o=$(".addCommentForm").attr("action"),a={_token:n,comment:tinyMCE.activeEditor.getContent({format:"raw"}),seconds:t};$.ajax({url:o,method:"POST",dataType:"json",data:a,beforeSend:function(){$(".preloader-wrapper").css("display","block"),$(".addCommentInput").css({height:"22px"})},error:function(e){500==e.status&&($("#Modal h4").text("خطأ"),$("#Modal p").html('حدث خطأ , من فضلك اعد تحميل الصفحة <a href="javascript:;" onclick="location.reload();">اعادة تحميل الصفحة</a> او لا تكتب تعليقاً فارغاً'),$("#Modal").modal(),$("#Modal").modal("open"))},complete:function(e){if($(".preloader-wrapper").css("display","none"),"done"!=e.responseJSON.status){var t;t=e.responseJSON.seconds<11&&e.responseJSON.seconds>2?"ثواني":"ثانية","Wait"==e.responseJSON.status&&tinyMCE.activeEditor.notificationManager.open({text:e.responseJSON.messageWait+": "+e.responseJSON.seconds+" "+t,type:"error",timeout:2500,closeButton:!0})}else $(".addCommentInput").val("").css({height:"22px"}),$(".commentBox-Parent").prepend(e.responseJSON.div),$(".deleteCommentA").attr("onclick","$('#deleteCommentModal').modal();$('#deleteCommentModal').modal('open');var url = $(this).attr('url');$('.Yes').attr('href',url);"),tinyMCE.activeEditor.setContent("")}})}$(document).ready(function(){tinymce.init({selector:"#addComment",convert_newlines_to_brs:!0,plugins:["advlist link lists textcolor"],toolbar:"undo redo | styleselect | bold underline italic | alignleft aligncenter alignright | forecolor backcolor fontsizeselect | link",invalid_styles:"font-size",invalid_elements:"form,input,button",protect:[/\<\/?(if|endif)\>/g,/\<xsl\:[^>]+\>/g,/<\?php.*?\?>/g],content_css:"/THPosts/public/styles/css/tinymce.css",content_style:"*{direction:rtl}",setup:function(e){e.on("keydown",function(t){if(getCountCharacters()>=500)return 8==t.which?!0:(e.notificationManager.open({text:"الحد الاقصي للتعليق 500 حرف",type:"error",timeout:2500,closeButton:!0}),!1);if(9==t.which)return e.execCommand("insertParagraph",!1),!1;if(13==t.which){if("none"==$(".submitAddComment").css("display"))return getCountCharacters()>=10?(addComment(),!1):(e.notificationManager.open({text:"الحد الادني للتعليق 10 حروف",type:"error",timeout:2500,closeButton:!0}),!1);e.execCommand("insertParagraph",!1)}}),e.on("init",function(){var t=e.theme.panel&&e.theme.panel.find("#statusbar")[0];t&&window.setTimeout(function(){t.insert({type:"label",name:"wordcount",text:["Characters: {0}",getCountCharacters()],classes:"wordcount"},0),e.on("setcontent beforeaddundo keyup",update)},0)})},menubar:!1,resize:!1}),$(".showComments").on("click",function(){$(".commentDiv").show()}),$(".deleteCommentA").on("click",function(){$("#deleteCommentModal").modal(),$("#deleteCommentModal").modal("open");var e=$(this).attr("url");$(".Yes").attr("href",e)}),$(".addCommentForm").submit(function(){return addComment(),!1})});