function editCommentModal(t){$("#modalEditComment").modal(),$("#modalEditComment").modal("open");var e=$(t).parent().parent().children(".Comment").html();tinyMCE.get("editComment").setContent(e),idComment=$(t).parent().children(".deleteCommentA").attr("id")}function openModalDeleteComment(t){$("#deleteCommentModal").modal(),$("#deleteCommentModal").modal("open"),url=$(t).attr("url"),id=$(t).attr("id"),commentBox=$(t).parent().parent()}function deleteComment(){var t={_token:csrf_token,id:id};return $.ajax({url:url,method:"POST",data:t,dataType:"json",complete:function(t){"done"==t.responseText&&commentBox.fadeOut(500,function(){$(this).remove()})}}),!1}function getCountCharacters(){var t=tinyMCE.activeEditor.getContent({format:"raw"}).replace(/<.[^<>]*?>/g,"").replace(/&nbsp;|&#160;| /gi,"");return t.length}function update(){tinyMCE.activeEditor.theme.panel.find("#wordcount").text(["Characters: {0}",getCountCharacters()])}function Validate(t){if(getCountCharacters()>=500)return 8==t.which?!0:(tinyMCE.activeEditor.notificationManager.open({text:"الحد الاقصي للتعليق 500 حرف",type:"error",timeout:2500,closeButton:!0}),t.preventDefault());if(9==t.which)return tinyMCE.activeEditor.execCommand("insertParagraph",!1),t.preventDefault();if(13==t.which&&"none"==$(".submitAddComment").css("display")){if(getCountCharacters()>=10)return"editComment"==tinyMCE.activeEditor.id?editComment():addComment(),!1;if(getCountCharacters()<10)return tinyMCE.activeEditor.notificationManager.open({text:"الحد الادني للتعليق 10 أحرف",type:"error",timeout:2500,closeButton:!0}),t.preventDefault()}}function addComment(){var t,e=new Date,n=e.getSeconds();t=$(".addCommentForm").attr("action");var o={_token:csrf_token,comment:tinyMCE.activeEditor.getContent({format:"raw"}),seconds:n};getCountCharacters()>=500?tinyMCE.activeEditor.notificationManager.open({text:"الحد الاقصي للتعليق 500 حرف",type:"error",timeout:2500,closeButton:!0}):getCountCharacters()<10?tinyMCE.activeEditor.notificationManager.open({text:"الحد الادني للتعليق 10 أحرف",type:"error",timeout:2500,closeButton:!0}):$.ajax({url:t,method:"POST",dataType:"json",data:o,beforeSend:function(){$(".preloader-wrapper").css("display","block"),$(".addCommentInput").css({height:"22px"})},error:function(t){500==t.status&&tinyMCE.activeEditor.notificationManager.open({text:'حدث خطأ , من فضلك اعد تحميل الصفحة <a href="javascript:;" onclick="location.reload();">اعادة تحميل الصفحة</a> او لا تكتب تعليقاً كبيراً',type:"error",timeout:2500,closeButton:!0})},complete:function(t){if($(".preloader-wrapper").css("display","none"),"done"!=t.responseJSON.status){var e;e=t.responseJSON.seconds<11&&t.responseJSON.seconds>2?"ثواني":"ثانية","Wait"==t.responseJSON.status&&tinyMCE.activeEditor.notificationManager.open({text:t.responseJSON.messageWait+": "+t.responseJSON.seconds+" "+e,type:"error",timeout:2500,closeButton:!0})}else $(".addCommentInput").val("").css({height:"22px"}),$(".commentBox-Parent").prepend(t.responseJSON.div),$(".deleteCommentA").attr("onclick","openModalDeleteComment($(this));"),$(".editCommentA").attr("onclick","editCommentModal($(this));"),tinyMCE.activeEditor.setContent("")}})}function editComment(){var t=$(".editCommentForm").attr("action");t+="/"+idComment;var e={_token:csrf_token,comment:tinyMCE.get("editComment").getContent({format:"raw"})};getCountCharacters()>=500?tinyMCE.get("editComment").notificationManager.open({text:"الحد الاقصي للتعليق 500 حرف",type:"error",timeout:2500,closeButton:!0}):getCountCharacters()<10?tinyMCE.get("editComment").notificationManager.open({text:"الحد الادني للتعليق 10 أحرف",type:"error",timeout:2500,closeButton:!0}):$.ajax({url:t,method:"POST",dataType:"json",data:e,error:function(t){(500==t.status||"fail"==e.responseText)&&tinyMCE.get("editComment").notificationManager.open({text:'حدث خطأ , من فضلك اعد تحميل الصفحة <a href="javascript:;" onclick="location.reload();">اعادة تحميل الصفحة</a> او لا تكتب تعليقاً كبيراً',type:"error",timeout:2500,closeButton:!0})},complete:function(t){"edited"==t.responseText&&window.location.reload(!0)}})}var csrf_token,url,id,commentBox,idComment;csrf_token=$(".addCommentForm input[type='hidden']").val(),$(document).ready(function(){$(".editCommentForm").submit(function(){return editComment(),!1}),$(".deleteCommentA").on("click",function(){openModalDeleteComment($(this))}),$(".addCommentForm").submit(function(){return addComment(),!1}),$(".editCommentA").on("click",function(){editCommentModal($(this))}),$(".Yes").on("click",function(){deleteComment()}),$(".submitEditComment").on("click",function(){return editComment(),!1}),tinymce.init({selector:"textarea",convert_newlines_to_brs:!0,plugins:["advlist link lists textcolor"],toolbar:"undo redo | styleselect | bold underline italic | alignleft aligncenter alignright | forecolor backcolor fontsizeselect | link",invalid_styles:"font-size",invalid_elements:"form,input,button",protect:[/\<\/?(if|endif)\>/g,/\<xsl\:[^>]+\>/g,/<\?php.*?\?>/g],content_css:"/THPosts/public/styles/css/tinymce.css",content_style:"*{direction:rtl}",setup:function(t){t.on("keydown",function(t){Validate(t)}),t.on("init",function(){var e=t.theme.panel&&t.theme.panel.find("#statusbar")[0];e&&window.setTimeout(function(){e.insert({type:"label",name:"wordcount",text:["Characters: {0}",getCountCharacters()],classes:"wordcount"},0),t.on("setcontent beforeaddundo keyup",update)},0)})},menubar:!1,resize:!1})});